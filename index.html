<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <title>Warehouse Manager</title>
    <style>
        /* Lite enkel styling för att göra sidan mer lättläst */
        body {
            font-family: sans-serif;
            margin: 40px;
            background-color: #f9f9f9;
        }

        .product-card {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: #fff;
            display: flex;
            justify-content: space-between;
            /* Lägger text till vänster och knapp till höger */
            align-items: center;
        }

        .form-container {
            background: #f4f4f4;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        input {
            margin-right: 10px;
            padding: 8px;
        }

        button {
            padding: 8px 15px;
            cursor: pointer;
        }

        .delete-btn {
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>Warehouse API Manager</h1>

    <div class="form-container">
        <h3>Add New Product</h3>
        <input type="text" id="name" placeholder="Name">
        <input type="number" id="price" placeholder="Price">
        <input type="text" id="desc" placeholder="Description">
        <button onclick="addProduct()">Save to Database</button>
    </div>

    <button onclick="fetchProducts()">Fetch All Products</button>

    <div id="productList">
    </div>

    <script>
        // Bashjälp för URL:en till ditt API
        const API_URL = 'http://localhost:5183/api/products';

        // FUNKTION: Hämta alla produkter från databasen (GET)
        async function fetchProducts() {
            try {
                // Vi skickar ett GET-anrop till vårt C#-API
                const response = await fetch(API_URL);
                const products = await response.json();

                const listDiv = document.getElementById('productList');
                listDiv.innerHTML = ''; // Rensa listan först

                // Vi loopar igenom varje produkt i listan
                products.forEach(p => {
                    const div = document.createElement('div');
                    div.className = 'product-card';

                    // Här skapar vi HTML för produkten och lägger till en Delete-knapp med produktens ID
                    div.innerHTML = `
                        <div>
                            <strong>${p.name}</strong> - ${p.price} kr<br>
                            ${p.description}
                        </div>
                        <button class="delete-btn" onclick="deleteProduct(${p.id})">Delete</button>
                    `;
                    listDiv.appendChild(div);
                });
            } catch (error) {
                console.error("Error fetching products:", error);
                alert("Could not connect to the API. Check if dotnet run is active.");
            }
        }

        // FUNKTION: Spara en ny produkt i databasen (POST)
        async function addProduct() {
            // 1. Skapa ett objekt med informationen från textrutorna
            const newProduct = {
                name: document.getElementById('name').value,
                price: parseFloat(document.getElementById('price').value),
                description: document.getElementById('desc').value,
                stockQuantity: 10 // Standardvärde
            };

            try {
                // 2. Skicka POST-anropet med JSON-data i body
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json' // Berättar för API:et att vi skickar JSON
                    },
                    body: JSON.stringify(newProduct) // Gör om objektet till en textsträng
                });

                if (response.ok) {
                    alert("Product saved successfully!");

                    // 3. Töm textrutorna
                    document.getElementById('name').value = '';
                    document.getElementById('price').value = '';
                    document.getElementById('desc').value = '';

                    // 4. Uppdatera listan så vi ser den nya produkten direkt
                    fetchProducts();
                }
            } catch (error) {
                console.error("Error adding product:", error);
                alert("Failed to save product.");
            }
        }

        // FUNKTION: Ta bort en produkt (DELETE)
        async function deleteProduct(id) {
            // Fråga först om användaren är säker
            if (!confirm("Are you sure you want to delete this product?")) return;

            try {
                // Skicka DELETE-anrop till t.ex. http://localhost:5183/api/products/5
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    // Uppdatera listan på skärmen
                    fetchProducts();
                } else {
                    alert("Could not delete product.");
                }
            } catch (error) {
                console.error("Error deleting product:", error);
            }
        }

        // Kör funktionen direkt när sidan laddas så vi ser produkterna direkt
        fetchProducts();
    </script>
</body>

</html>